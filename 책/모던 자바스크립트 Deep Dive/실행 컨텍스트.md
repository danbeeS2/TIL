# 실행 컨텍스트 (Execution Context)

## 1) 실행 컨텍스트 개념

실행 컨텍스트는 **자바스크립트의 동작 원리를 담고 있는 핵심 개념**이다.  
실행 컨텍스트를 이해하면 다음을 이해할 수 있다.

- 자바스크립트가 스코프를 기반으로 `식별자`와 `식별자에 바인딩된 값을 관리`하는 방식
- `호이스팅`이 발생하는 이유
- `클로저`가 동작하는 원리
- `태스크 큐`와 `이벤트 핸들러`의 동작 방식
- `비동기 처리`의 동작 방식

즉, 실행 컨텍스트는 코드가 **어떤 환경에서 실행되고, 어떤 변수를 참조할 수 있는지**를 결정하는 실행 단위다.

## 2) 소스코드 타입과 실행 컨텍스트

ESMAScript 사양에 따르면 `소스코드는 4가지 타입`으로 구분된다.  
타입에 따라 실행 컨텍스트 생성 과정과 관리 대상이 달라진다.

### ① `전역 코드` (Global code)

- 프로그램이 시작될 때 가장 먼저 실행되는 코드
- **전역 실행 컨텍스트** 생성
- 전역 변수를 관리하기 위해 전역 스코프 생성
- `var`전역 변수와 `함수 선언문` 함수는 전역 객체(window/global)의 프로퍼티로 등록

  ```js
  var a = 1; // window.a 로 접근 가능
  function foo() {} // window.foo 로 접근 가능

  let b = 2; // window.b ❌ → 전역 렉시컬 환경에만 저장
  ```

### ② `함수 코드` (Function code)

- 함수가 호출될 때 실행되는 코드
- 함수 호출 시마다 **새로운 실행 컨텍스트** 생성
- 지역 스코프, 매개변수, 지역 변수, arguments 객체를 관리
- 함수 스코프는 상위 스코프와 연결되어 **스코프 체인**을 형성

### ③ `eval 코드`(Eval code)

- `eval()` 안에 전달된 문자열이 코드로 실행될 때 사용
  - `일반 모드`: 기존 스코프를 그대로 사용
  - `strict mode`: **독자적인 실행 컨텍스트**와 스코프를 생성

### ④ `모듈 코드`(Module code)

- ES6 모듈(`import` / `export`)에서 실행되는 코드
- 모듈별로 **독립적인 모듈 스코프** 생성
- 전역 스코프와 완전히 분리되어 안전하게 관리됨

---

> 실행 컨텍스트는 **코드 실행에 필요한 환경 정보(스코프, 변수, this 등)** 를 담는 컨테이너다.  
> 소스코드 타입에 따라 서로 다른 실행 컨텍스트가 만들어진다.
>
> > - 전역 코드 → 전역 실행 컨텍스트 (전역 스코프 + 전역 객체)
> > - 함수 코드 → 함수 실행 컨텍스트 (지역 스코프, 지역변수, 매개변수, arguments)
> > - eval 코드 → 독자적인 실행 컨텍스트 (strict mode에서만)
> > - 모듈 코드 → 모듈 실행 컨텍스트 (독립적인 모듈 스코프)

## 3) 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드를 **두 단계**로 나누어 처리한다.

### ① `소스코드의 평가 단계`

1. 실행 컨텍스트 생성
2. 선언문만 먼저 실행
3. 식별자를 `key`로 실행 컨텍스트의 스코프(렉시컬 환경의 **환경 레코드**)에 등록
   - `var` → **선언 + 초기화(undefined)**
   - `let`/`const` → **선언만 (초기화 X, TDZ 상태)**
   - `function` (선언문) → **선언 + 초기화(함수 객체로 바인딩)**

### ② `소스코드의 실행 단계`

1. 선언문을 제외한 **나머지 코드** 순차 실행
   - `let`/`const` 선언문에 도달 → **초기화 수행**
   - 초기화 이후부터 참조 가능
2. 변수 참조/연산 시 → 실행 컨텍스트가 관리하는 스코프에서 검색
3. 실행 결과(걊) → 다시 실행 컨텍스트의 스코프에 반영

## 4) 실행 컨텍스트의 역할

코드 실행을 위해서는 `스코프`, `스코프 내의 식별자`, `코드 실행 순서` 등의 관리가 필요하다.

1. **식별자 관리**

- 선언된 변수, 함수, 클래스 등을 스코프 단위로 구분하여 등록
- 상태 변화를 관리

2. **스코프 체인 유지**

- 스코프 체인을 형성
- 상위 스코프로 연결하여 식별자를 검색 가능하게 함

3. **실행 순서 관리**

- 함수 호출 시 새로운 실행 컨텍스트 생성
- 종료되면 호출한 위치로 되돌아감
- 이 흐름은 **실행 컨텍스트 스택(Call Stack)** 으로 관리

<br />

> `실행 컨텍스트` = **소스코드를 실행하는 데 필요한 모든 환경을 제공하는 컨테이너** + 실행 **결과를 실제로 관리하는 영역**
>
> - 스코프와 식별자 → 렉시컬 환경으로 관리
> - 코드 실행 순서 → 실행 컨텍스트 스택으로 관리
>
> 모든 자바스크립트 코드는 실행 컨텍스트를 통해 실행되고 관리된다.

<br />
