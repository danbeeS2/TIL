# 4.2 íƒ€ì… ì¢íˆê¸° - íƒ€ì… ê°€ë“œ

íƒ€ì… ì¢íˆê¸°(Narrowing)ëŠ” **ë³€ìˆ˜ ë˜ëŠ” í‘œí˜„ì‹ì˜ íƒ€ì… ë²”ìœ„ë¥¼ ë” ì‘ì€ ë²”ìœ„ë¡œ ì¢íˆëŠ” ê³¼ì •**ì´ë‹¤.

#### íƒ€ì… ì¢íˆê¸°ì˜ ì¥ì 

- **ë” ì •í™•í•˜ê³  ëª…í™•í•œ íƒ€ì… ì¶”ë¡ **ì´ ê°€ëŠ¥í•´ì§„ë‹¤.
- **ë³µì¡í•œ íƒ€ì…ì„ íŠ¹ì • ë²”ìœ„ë¡œ ì¶•ì†Œ**í•˜ì—¬ íƒ€ì… ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.

## 1. íƒ€ì… ê°€ë“œì— ë”°ë¼ ë¶„ê¸° ì²˜ë¦¬í•˜ê¸°

### 1) íƒ€ì… ê°€ë“œë€?

**íƒ€ì… ê°€ë“œ(Type Guard)** ëŠ” **ëŸ°íƒ€ì„**ì—ì„œ ì¡°ê±´ë¬¸ì„ í™œìš©í•´ íŠ¹ì • íƒ€ì…ì„ ê²€ì‚¬í•˜ê³ , íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ í•´ë‹¹ ë³€ìˆ˜ì˜ íƒ€ì…ì„ ì¢í˜€ë‚˜ê°€ë„ë¡ ë•ëŠ” ê¸°ëŠ¥ì´ë‹¤.

> **ìŠ¤ì½”í”„(scope)** : ë³€ìˆ˜ì™€ í•¨ìˆ˜ ë“±ì˜ ì‹ë³„ìê°€ ìœ íš¨í•œ ë²”ìœ„. ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜ì—­

### 2) íƒ€ì… ê°€ë“œê°€ í•„ìš”í•œ ì´ìœ 

- ë³€ìˆ˜ì˜ íƒ€ì…ì´ `A | B`ì²˜ëŸ¼ ì—¬ëŸ¬ ê°œì¼ ë•Œ, **ê° íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ëŠ” ë¡œì§ì´ í•„ìš”**í•  ìˆ˜ ìˆë‹¤.
- í•˜ì§€ë§Œ **íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ íƒ€ì… ì •ë³´ëŠ” ì»´íŒŒì¼ ì‹œ ì œê±°**ë˜ë¯€ë¡œ, ì¼ë°˜ì ì¸ `if`ë¬¸ìœ¼ë¡œëŠ” íƒ€ì…ì„ êµ¬ë¶„í•  ìˆ˜ ì—†ë‹¤.
- ë”°ë¼ì„œ **ì»´íŒŒì¼í•´ë„ íƒ€ì… ì •ë³´ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ë°©ë²•**ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

---

### 2) íƒ€ì… ê°€ë“œ

**íƒ€ì… ê°€ë“œ**ëŠ” íŠ¹ì • ë¬¸ë§¥ ì•ˆì—ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ í•´ë‹¹ ë³€ìˆ˜ë¥¼ íƒ€ì… Aë¡œ ì¶”ë¡ í•˜ë„ë¡ ìœ ë„í•˜ë©´ì„œ **ëŸ°íƒ€ì„ì—ì„œ ìœ íš¨**í•œ ë°©ë²•ì´ë‹¤.

### 3) íƒ€ì… ê°€ë“œì˜ ì¢…ë¥˜

### 1ï¸âƒ£ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—°ì‚¬ìë¥¼ ì‚¬ìš©í•œ íƒ€ì… ê°€ë“œ

ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ê¸°ë³¸ ì—°ì‚°ìë¥¼ í™œìš©í•˜ì—¬ **ëŸ°íƒ€ì„ì—ì„œë„ íƒ€ì…ì„ êµ¬ë¶„í•˜ëŠ” ë°©ì‹**ì´ë‹¤.

> **ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ **
>
> - ëŸ°íƒ€ì„ì— ìœ íš¨í•œ íƒ€ì… ê°€ë“œë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œë‹¤.
> - "ëŸ°íƒ€ì„ì— ìœ íš¨í•˜ë‹¤ëŠ” ê²ƒ"ì€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¿ë§Œ ì•„ë‹ˆë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬¸ë²•ì´ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ë‹¤.

#### ì£¼ìš” ì—°ì‚°ì

| ì—°ì‚°ì       | ì„¤ëª…                                    |
| ------------ | --------------------------------------- |
| `typeof`     | ì›ì‹œ íƒ€ì…(`string`, `number` ë“±)ì„ íŒë³„ |
| `instanceof` | ê°ì²´ê°€ íŠ¹ì • í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ í™•ì¸  |
| `in`         | ê°ì²´ì— íŠ¹ì • ì†ì„±ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸      |

#### ì˜ˆì œ - `typeof` ì—°ì‚°ì í™œìš©

```typescript
function printValue(value: string | number) {
  if (typeof value === "string") {
    console.log(`ë¬¸ìì—´: ${value.toUpperCase()}`);
  } else {
    console.log(`ìˆ«ì: ${value.toFixed(2)}`);
  }
}
```

- `typeof value === "string"` â†’ `value`ê°€ ë¬¸ìì—´ íƒ€ì…ì„ì´ ë³´ì¥ë˜ë¯€ë¡œ, `toUpperCase()`ë¥¼ ì•ˆì „í•˜ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

---

#### ì˜ˆì œ - `instanceof` ì—°ì‚°ì í™œìš©

```typescript
class Dog {
  bark() {
    console.log("ë©ë©!");
  }
}

class Cat {
  meow() {
    console.log("ì•¼ì˜¹!");
  }
}

function makeSound(animal: Dog | Cat) {
  if (animal instanceof Dog) {
    animal.bark();
  } else {
    animal.meow();
  }
}
```

- `animal instanceof Dog`ë¥¼ í†µí•´ `animal`ì´ `Dog`ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

---

#### ì˜ˆì œ - `in` ì—°ì‚°ì í™œìš©

```typescript
interface Car {
  drive(): void;
}

interface Boat {
  sail(): void;
}

function move(vehicle: Car | Boat) {
  if ("drive" in vehicle) {
    vehicle.drive();
  } else {
    vehicle.sail();
  }
}
```

- `"drive" in vehicle`ì„ ì‚¬ìš©í•˜ë©´ `Car`ì¸ì§€ `Boat`ì¸ì§€ ëŸ°íƒ€ì„ì—ì„œë„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

---

### 2ï¸âƒ£ ì‚¬ìš©ì ì •ì˜ íƒ€ì… ê°€ë“œ

ì‚¬ìš©ìê°€ ì§ì ‘ ì–´ë–¤ íƒ€ì…ìœ¼ë¡œ ê°’ì„ ì¢í ì§€ ì§€ì •í•˜ëŠ” ë°©ì‹ì´ë‹¤.

> ì‚¬ìš©ì ì •ì˜ íƒ€ì… ê°€ë“œ(User-Defined Type Guard)\*\*ëŠ” `is` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • íƒ€ì…ì„ íŒë³„í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤.

#### ì˜ˆì œ

```typescript
interface Fish {
  swim(): void;
}

interface Bird {
  fly(): void;
}

function isFish(pet: Fish | Bird): pet is Fish {
  return (pet as Fish).swim !== undefined;
}

function moveAnimal(animal: Fish | Bird) {
  if (isFish(animal)) {
    animal.swim();
  } else {
    animal.fly();
  }
}
```

- `isFish(pet)` í•¨ìˆ˜ëŠ” `pet`ì´ `Fish` íƒ€ì…ì¸ì§€ íŒë³„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” `isFish` í•¨ìˆ˜ì˜ ë°˜í™˜ íƒ€ì… `pet is Fish`ë¥¼ ë³´ê³  **`if`ë¬¸ ë‚´ë¶€ì—ì„œ `pet`ì„ ìë™ìœ¼ë¡œ `Fish` íƒ€ì…ìœ¼ë¡œ ì¢í˜€ì¤€ë‹¤**.

---

## 2. ì›ì‹œ íƒ€ì…ì„ ì¶”ë¡ í•  ë•Œ: `typeof` ì—°ì‚°ì í™œìš©í•˜ê¸°

`typeof` ì—°ì‚°ìë¥¼ í™œìš©í•˜ë©´ **ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì›ì‹œ íƒ€ì…(primitive types)**ì„ ì‰½ê²Œ íŒë³„í•  ìˆ˜ ìˆë‹¤.

- `typeof A === B`ë¥¼ ì¡°ê±´ìœ¼ë¡œ ë¶„ê¸°ì²˜ë¦¬í•˜ë©´, í•´ë‹¹ ë¶„ê¸° ë‚´ì—ì„œ `A`ì˜ íƒ€ì…ì´ `B`ë¡œ ì¶”ë¡ ëœë‹¤.
- ê·¸ëŸ¬ë‚˜ `typeof`ëŠ” **ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ê¸°ë³¸ íƒ€ì… ì‹œìŠ¤í…œë§Œ** ë°˜ì˜í•˜ë¯€ë¡œ, **ê°ì²´ íƒ€ì…ì„ ì„¸ë°€í•˜ê²Œ êµ¬ë¶„í•˜ëŠ” ë°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤.**
  - ì˜ˆë¥¼ ë“¤ì–´ `typeof null`ì€ `"object"`ë¡œ ë‚˜ì˜¤ê³ , ë°°ì—´(`Array`) ì—­ì‹œ `"object"`ë¡œ íŒë³„ëœë‹¤.
- ë”°ë¼ì„œ `typeof` ì—°ì‚°ìëŠ” **ì›ì‹œ íƒ€ì…ì„ ì¢íˆëŠ” ìš©ë„ë¡œ í™œìš©í•˜ëŠ” ê²ƒì´ ì ì ˆ**í•˜ë‹¤.

### `typeof`ë¡œ íŒë³„ ê°€ëŠ¥í•œ íƒ€ì… ëª©ë¡

| `typeof` ê²€ì‚¬ ê²°ê³¼ | ì‹¤ì œ íƒ€ì…                                |
| ------------------ | ---------------------------------------- |
| `"string"`         | `string`                                 |
| `"number"`         | `number`                                 |
| `"boolean"`        | `boolean`                                |
| `"undefined"`      | `undefined`                              |
| **`"object"`**     | **`null`, `object`, `array`** (ğŸ“Œ ì£¼ì˜!) |
| `"function"`       | `function`                               |
| `"bigint"`         | `bigint`                                 |
| `"symbol"`         | `symbol`                                 |

### ì˜ˆì œ ì½”ë“œ

```typescript
// ë¬¸ìì—´ê³¼ Date ê°ì²´ë¥¼ ì…ë ¥ë°›ì•„ ë¬¸ìì—´ì—ì„œ í•˜ì´í”ˆì„ ìŠ¬ë˜ì‹œë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
const replaceHyphen = (date: string | Date): string | Date => {
  if (typeof date === "string") {
    // ì´ ë¶„ê¸°ì—ì„œëŠ” dateì˜ íƒ€ì…ì´ stringìœ¼ë¡œ ì¶”ë¡ ë¨
    return date.replace(/-/g, "/");
  }

  return date;
};
```

---

## 3. ì¸ìŠ¤í„´ìŠ¤í™”ëœ ê°ì²´ íƒ€ì…ì„ íŒë³„í•  ë•Œ: instanceof ì—°ì‚°ì í™œìš©í•˜ê¸°

`instanceof` ì—°ì‚°ìëŠ” íŠ¹ì • ê°ì²´ê°€ íŠ¹ì • í´ë˜ìŠ¤(ìƒì„±ì í•¨ìˆ˜)ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©ëœë‹¤.  
ì¦‰, `instanceof` ì—°ì‚°ìë¥¼ í™œìš©í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤í™”ëœ ê°ì²´ íƒ€ì…ì„ íŒë³„í•  ìˆ˜ ìˆë‹¤.

### 1) `instanceof` ì—°ì‚°ì

- **í˜•ì‹:** `A instanceof B`

  - `A`: íƒ€ì…ì„ ê²€ì‚¬í•  ëŒ€ìƒ (ë³€ìˆ˜)
  - `B`: ìƒì„±ì í•¨ìˆ˜ ë˜ëŠ” í´ë˜ìŠ¤

- **ë°˜í™˜ê°’:**

  - `true`: `A`ê°€ `B`ì˜ ì¸ìŠ¤í„´ìŠ¤ë¼ë©´
  - `false`: ê·¸ë ‡ì§€ ì•Šë‹¤ë©´

---

#### ì˜ˆì œ 1 - `instanceof` ê¸°ë³¸ ê°œë…

```ts
class Animal {}
class Dog extends Animal {}

const myDog = new Dog();

console.log(myDog instanceof Dog); // true
console.log(myDog instanceof Animal); // true (ìƒì† ê´€ê³„)
console.log(myDog instanceof Object); // true (ëª¨ë“  ê°ì²´ëŠ” Objectì˜ ì¸ìŠ¤í„´ìŠ¤)
console.log(myDog instanceof Array); // false
```

- `myDog`ëŠ” `Dog`ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ë¯€ë¡œ `myDog instanceof Dog === true`
- `Dog`ê°€ `Animal`ì„ ìƒì†í–ˆìœ¼ë¯€ë¡œ `myDog instanceof Animal === true`
- ëª¨ë“  ê°ì²´ëŠ” `Object`ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ë¯€ë¡œ `myDog instanceof Object === true`
- `Array`ì™€ëŠ” ë¬´ê´€í•˜ë¯€ë¡œ `myDog instanceof Array === false`

---

#### ì˜ˆì œ 2 - `instanceof`ë¥¼ í™œìš©í•œ íƒ€ì… íŒë³„

```ts
interface Range {
  start: Date;
  end: Date;
}

interface DatePickerProps {
  selectedDates?: Date | Range;
}

export function convertToRange(selected?: Date | Range): Range | undefined {
  return selected instanceof Date
    ? { start: selected, end: selected } // Dateë¼ë©´ Range í˜•íƒœë¡œ ë³€í™˜
    : selected; // ì´ë¯¸ Rangeë¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
}
```

> `convertToRange` í•¨ìˆ˜ ë™ì‘ ì›ë¦¬
>
> 1. `selected`ê°€ `Date` íƒ€ì…ì´ë©´ `{ start: selected, end: selected }`ë¥¼ ë°˜í™˜ (Rangeë¡œ ë³€í™˜).
> 2. `selected`ê°€ `Range` íƒ€ì…ì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜.

```ts
console.log(convertToRange(new Date()));
// { start: 2025-01-30T10:00:00.000Z, end: 2025-01-30T10:00:00.000Z }

console.log(convertToRange({ start: new Date(), end: new Date() }));
// { start: 2025-01-30T10:00:00.000Z, end: 2025-01-30T10:00:00.000Z }
```

- `new Date()`ë¥¼ ì „ë‹¬í•˜ë©´ `{ start, end }` í˜•íƒœì˜ `Range` ê°ì²´ë¡œ ë³€í™˜ë¨.
- ì´ë¯¸ `{ start, end }` ê°ì²´ë¼ë©´ ë³€í™˜ ì—†ì´ ê·¸ëŒ€ë¡œ ë°˜í™˜ë¨.

---

### 2) `instanceof` ì‚¬ìš© ì‹œ ì£¼ì˜í•  ì 

#### 1ï¸âƒ£ `null` ë˜ëŠ” `undefined` ê²€ì‚¬ ë¶ˆê°€

```ts
console.log(null instanceof Object); // false
console.log(undefined instanceof Object); // false
```

- `null`ê³¼ `undefined`ëŠ” ì›ì‹œ íƒ€ì…ì´ê¸° ë•Œë¬¸ì— `instanceof`ë¡œ ê²€ì‚¬í•  ìˆ˜ ì—†ë‹¤.

##### âœ… í•´ê²° ë°©ë²• - `typeof` ì‚¬ìš©

```ts
console.log(typeof null === "object"); // true
console.log(typeof undefined === "undefined"); // true
```

---

#### 2ï¸âƒ£ í´ë˜ìŠ¤ë¡œ ë§Œë“  ê°ì²´ì—ì„œë§Œ ë™ì‘

```ts
interface Person {
  name: string;
}

const p: Person = { name: "Alice" };
console.log(p instanceof Person); // Error: 'Person' only refers to a type
```

- `interface`ëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ íƒ€ì… ì‹œìŠ¤í…œì—ì„œë§Œ ì¡´ì¬í•˜ê³ , ì»´íŒŒì¼ í›„ì—ëŠ” ì‚¬ë¼ì§€ë¯€ë¡œ ëŸ°íƒ€ì„ì— ë™ì‘í•˜ëŠ” `instanceof`ëŠ” `interface`ì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

##### âœ… í•´ê²° ë°©ë²• 1 - `typeof` ì—°ì‚°ì ì‚¬ìš©

```ts
if (typeof p === "object") {
  console.log("pëŠ” ê°ì²´ì…ë‹ˆë‹¤.");
}
```

##### âœ… í•´ê²° ë°©ë²• 2 - ì‚¬ìš©ì ì •ì˜ íƒ€ì… ê°€ë“œ ì‚¬ìš©

```ts
// `obj`ê°€ `Person` íƒ€ì…ì¸ì§€ í™•ì¸í•˜ëŠ” íƒ€ì… ê°€ë“œ í•¨ìˆ˜
function isPerson(obj: any): obj is Person {
  return "name" in obj;
}

const p: unknown = { name: "Alice" };
console.log(isPerson(p)); // true
```

- `"name" in obj`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ê°€ `Person` íƒ€ì…ì¸ì§€ íŒë³„í•  ìˆ˜ ìˆë‹¤.

---

#### 3ï¸âƒ£ ë‹¤ë¥¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(iframe, worker)ì—ì„œ ìƒì„±ëœ ê°ì²´ëŠ” íŒë³„ì´ ì–´ë ¤ì›€

- `instanceof`ëŠ” **ê°™ì€ ì‹¤í–‰ í™˜ê²½(JavaScript ì—”ì§„ ì»¨í…ìŠ¤íŠ¸) ë‚´ì—ì„œë§Œ ì •í™•í•˜ê²Œ ë™ì‘**í•œë‹¤.
- ë‹¤ë¥¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(iframe, Web Worker ë“±)ì—ì„œ ìƒì„±ëœ ê°ì²´ëŠ” `instanceof`ë¡œ ê²€ì‚¬í•˜ë©´ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤.

```ts
const iframe = document.createElement("iframe");
document.body.appendChild(iframe);
const iframeWindow = iframe.contentWindow;

const obj = new iframeWindow!.Object();
console.log(obj instanceof Object); // âŒ false (ê¸°ëŒ€í–ˆë˜ ê²°ê³¼ì™€ ë‹¤ë¦„)
```

- `iframe`ì—ì„œ ìƒì„±ëœ `Object`ëŠ” **ê¸°ë³¸ JavaScript ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì™€ ë‹¤ë¥´ë¯€ë¡œ** `instanceof Object`ê°€ `false`ê°€ ëœë‹¤.

##### âœ… í•´ê²° ë°©ë²• - `Object.prototype.toString.call()` ì‚¬ìš©

```ts
console.log(Object.prototype.toString.call(obj)); // [object Object]
```

- ì´ ë°©ë²•ì€ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ë‹¬ë¼ë„ ì •í™•í•œ íƒ€ì…ì„ íŒë³„í•  ìˆ˜ ìˆë‹¤.

---
