# 4.2 타입 좁히기 - 타입 가드

타입 좁히기(Narrowing)는 **변수 또는 표현식의 타입 범위를 더 작은 범위로 좁히는 과정**이다.

#### 타입 좁히기의 장점

- **더 정확하고 명확한 타입 추론**이 가능해진다.
- **복잡한 타입을 특정 범위로 축소**하여 타입 안정성을 높일 수 있다.

## 1. 타입 가드에 따라 분기 처리하기

### 1) 타입 가드란?

**타입 가드(Type Guard)** 는 **런타임**에서 조건문을 활용해 특정 타입을 검사하고, 타입스크립트가 해당 변수의 타입을 좁혀나가도록 돕는 기능이다.

> **스코프(scope)** : 변수와 함수 등의 식별자가 유효한 범위. 변수와 함수를 선언하거나 사용할 수 있는 영역

### 2) 타입 가드가 필요한 이유

- 변수의 타입이 `A | B`처럼 여러 개일 때, **각 타입에 따라 다르게 동작하는 로직이 필요**할 수 있다.
- 하지만 **타입스크립트의 타입 정보는 컴파일 시 제거**되므로, 일반적인 `if`문으로는 타입을 구분할 수 없다.
- 따라서 **컴파일해도 타입 정보가 사라지지 않는 방법**을 사용해야 한다.

---

### 2) 타입 가드

**타입 가드**는 특정 문맥 안에서 타입스크립트가 해당 변수를 타입 A로 추론하도록 유도하면서 **런타임에서 유효**한 방법이다.

### 3) 타입 가드의 종류

### 1️⃣ 자바스크립트 연사자를 사용한 타입 가드

자바스크립트의 기본 연산자를 활용하여 **런타임에서도 타입을 구분하는 방식**이다.

> **자바스크립트 연산자를 사용하는 이유**
>
> - 런타임에 유효한 타입 가드를 만들기 위해서다.
> - "런타임에 유효하다는 것"은 타입스크립트뿐만 아니라 자바스크립트에서도 사용할 수 있는 문법이어야 한다는 의미다.

#### 주요 연산자

| 연산자       | 설명                                    |
| ------------ | --------------------------------------- |
| `typeof`     | 원시 타입(`string`, `number` 등)을 판별 |
| `instanceof` | 객체가 특정 클래스의 인스턴스인지 확인  |
| `in`         | 객체에 특정 속성이 존재하는지 확인      |

#### 예제 - `typeof` 연산자 활용

```typescript
function printValue(value: string | number) {
  if (typeof value === "string") {
    console.log(`문자열: ${value.toUpperCase()}`);
  } else {
    console.log(`숫자: ${value.toFixed(2)}`);
  }
}
```

- `typeof value === "string"` → `value`가 문자열 타입임이 보장되므로, `toUpperCase()`를 안전하게 호출할 수 있다.

---

#### 예제 - `instanceof` 연산자 활용

```typescript
class Dog {
  bark() {
    console.log("멍멍!");
  }
}

class Cat {
  meow() {
    console.log("야옹!");
  }
}

function makeSound(animal: Dog | Cat) {
  if (animal instanceof Dog) {
    animal.bark();
  } else {
    animal.meow();
  }
}
```

- `animal instanceof Dog`를 통해 `animal`이 `Dog`의 인스턴스인지 확인할 수 있다.

---

#### 예제 - `in` 연산자 활용

```typescript
interface Car {
  drive(): void;
}

interface Boat {
  sail(): void;
}

function move(vehicle: Car | Boat) {
  if ("drive" in vehicle) {
    vehicle.drive();
  } else {
    vehicle.sail();
  }
}
```

- `"drive" in vehicle`을 사용하면 `Car`인지 `Boat`인지 런타임에서도 구분할 수 있다.

---

### 2️⃣ 사용자 정의 타입 가드

사용자가 직접 어떤 타입으로 값을 좁힐 지 지정하는 방식이다.

> 사용자 정의 타입 가드(User-Defined Type Guard)\*\*는 `is` 키워드를 사용하여 특정 타입을 판별하는 함수를 정의한다.

#### 예제

```typescript
interface Fish {
  swim(): void;
}

interface Bird {
  fly(): void;
}

function isFish(pet: Fish | Bird): pet is Fish {
  return (pet as Fish).swim !== undefined;
}

function moveAnimal(animal: Fish | Bird) {
  if (isFish(animal)) {
    animal.swim();
  } else {
    animal.fly();
  }
}
```

- `isFish(pet)` 함수는 `pet`이 `Fish` 타입인지 판별하는 역할을 한다.
- 타입스크립트는 `isFish` 함수의 반환 타입 `pet is Fish`를 보고 **`if`문 내부에서 `pet`을 자동으로 `Fish` 타입으로 좁혀준다**.
